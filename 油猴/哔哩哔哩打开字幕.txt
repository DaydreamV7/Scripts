// ==UserScript==
// @name         哔哩哔哩自动打开中文字幕脚本
// @namespace    https://bbs.tampermonkey.net.cn/
// @version      0.2.0
// @description  自动打开哔哩哔哩视频的中文字幕
// @author       You
// @match        https://www.bilibili.com/video/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // 等待页面加载完成
    const waitForElement = (selector, timeout = 10000) => {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            const interval = setInterval(() => {
                const element = document.querySelector(selector);
                if (element) {
                    clearInterval(interval);
                    resolve(element);
                } else if (Date.now() - start > timeout) {
                    clearInterval(interval);
                    reject(new Error(`Element ${selector} not found within ${timeout}ms`));
                }
            }, 500);
        });
    };

    // 点击字幕按钮
    const clickSubtitleBtn = async () => {
        try {
            const subtitleBtn = await waitForElement("[aria-label='字幕']");
            subtitleBtn.click();
            // 等待字幕菜单展开
            await new Promise(resolve => setTimeout(resolve, 300));
            // 查找并点击“中文（中国）”选项
            const chineseSubtitle = document.querySelector(".bpx-player-ctrl-subtitle-language-item[data-lan='ai-zh']");
            if (chineseSubtitle) {
                chineseSubtitle.click();
            } else {
                console.log("未找到中文（中国）字幕选项");
            }
        } catch (error) {
            console.error(error);
        }
    };

    // 页面加载完成后执行
    window.addEventListener('load', clickSubtitleBtn);
})();
